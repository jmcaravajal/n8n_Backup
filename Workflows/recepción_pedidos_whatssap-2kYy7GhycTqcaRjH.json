{"createdAt":"2025-01-14T00:11:13.240Z","updatedAt":"2025-01-14T00:11:13.240Z","id":"2kYy7GhycTqcaRjH","name":"Recepci√≥n_Pedidos_Whatssap","active":false,"nodes":[{"parameters":{"assignments":{"assignments":[{"id":"cc1a1dba-16f3-40ee-b497-c550dd332751","name":"mensaje","value":"={{ $json.message.text }}","type":"string"}]},"options":{}},"id":"48b3d73a-5a8d-45db-b2f1-ea6ed80050c7","name":"Texto","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[240,500]},{"parameters":{"resource":"file","fileId":"={{ $json.message.voice.file_id }}"},"id":"926ea3cc-dfa9-4c20-bd8a-1584cee32a0a","name":"Descarga_audio","type":"n8n-nodes-base.telegram","typeVersion":1.2,"position":[40,740]},{"parameters":{"method":"POST","url":"https://api.openai.com/v1/audio/transcriptions","authentication":"predefinedCredentialType","nodeCredentialType":"openAiApi","sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"model","value":"whisper-1"},{"parameterType":"formBinaryData","name":"file","inputDataFieldName":"data"}]},"options":{}},"id":"003fa54b-e14a-4f6b-8341-15d145667999","name":"Transcribe audio a texto","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[240,740]},{"parameters":{"assignments":{"assignments":[{"id":"eac8864e-2f64-4a8b-96c3-12ecfa969c82","name":"mensaje","value":"={{ $json.text }}","type":"string"}]},"options":{}},"id":"298890e4-76d2-4bd6-bb21-2258d2f8336a","name":"Audio","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[440,740]},{"parameters":{"assignments":{"assignments":[{"id":"cc1a1dba-16f3-40ee-b497-c550dd332751","name":"Chat_ID","value":"={{ $('Telegram Trigger').item.json.message.chat.id }}","type":"string"},{"id":"5c4ff116-f7a4-47b1-98fa-dc464a9c8077","name":"Nombre","value":"={{ $('Telegram Trigger').item.json.message.from.first_name }}","type":"string"},{"id":"6d2cd125-3e58-402b-a529-9698545c2636","name":"Mensaje","value":"={{ $json.mensaje }}","type":"string"}]},"options":{}},"id":"1c3bf4a8-996e-475e-be1b-53eedd197c17","name":"Envio_Datos","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[660,640]},{"parameters":{"options":{}},"id":"c80b1691-e470-498d-908f-d16db0816c1f","name":"OpenAI Chat Model","type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1,"position":[1840,820]},{"parameters":{},"id":"c887fbd5-68d2-4c33-a364-e18738a7e4a3","name":"Calculator","type":"@n8n/n8n-nodes-langchain.toolCalculator","typeVersion":1,"position":[2080,820]},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"leftValue":"={{ $json.message.text }}","rightValue":"","operator":{"type":"string","operation":"exists","singleValue":true}}],"combinator":"and"},"renameOutput":true,"outputKey":"Texto"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"d82cf6cc-d916-4c68-8606-ac497bfcb60f","leftValue":"={{ $json.message.voice }}","rightValue":"","operator":{"type":"object","operation":"exists","singleValue":true}}],"combinator":"and"},"renameOutput":true,"outputKey":"Audio"}]},"options":{}},"id":"c6ec1582-3cbb-4482-a94a-5ffb66cfaf07","name":"Switch","type":"n8n-nodes-base.switch","typeVersion":3.2,"position":[-200,640]},{"parameters":{"operation":"push","list":"={{ $json.Chat_ID }}","messageData":"={{ $json.Mensaje }}","tail":true},"id":"1eb6b5f7-388d-4438-ba52-384618fa2126","name":"Guardar_Mensaje","type":"n8n-nodes-base.redis","typeVersion":1,"position":[840,640]},{"parameters":{},"id":"2aa82c40-7e27-43c0-84f8-be19e387c631","name":"Wait","type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[1020,640],"webhookId":"530f46db-4168-4b3f-985a-5fd6c00f2b0c"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"83ef3299-b253-4f82-a698-d34e750bb2a0","leftValue":"={{ $json.Mensajes.last() }}","rightValue":"={{ $('Envio_Datos').item.json.Mensaje }}","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"options":{}},"id":"bab46ddd-7653-45dd-88b6-05bdf820c0f4","name":"If","type":"n8n-nodes-base.if","typeVersion":2.2,"position":[1400,640]},{"parameters":{"operation":"get","propertyName":"Mensajes","key":"={{ $json.Chat_ID }}","options":{}},"id":"94346520-171f-4734-aac5-eeda76d198d2","name":"Recuperar_Mensaje","type":"n8n-nodes-base.redis","typeVersion":1,"position":[1200,640]},{"parameters":{},"id":"d13f646f-15d6-44e2-8919-a9c556ac3266","name":"No_hacer_nada","type":"n8n-nodes-base.noOp","typeVersion":1,"position":[1600,860]},{"parameters":{"assignments":{"assignments":[{"id":"0f85cb22-2331-4311-b701-99570fa75631","name":"Mensaje","value":"={{ $json.Mensajes.join('\\n') }}","type":"string"},{"id":"2722a936-b7c3-436d-bdbc-6f904900bc76","name":"Chat_ID","value":"={{ $('Wait').item.json.Chat_ID }}","type":"string"}]},"options":{}},"id":"77ce2801-89e2-46bc-81ea-58086258a661","name":"Juntar_Mensajes","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[1600,620]},{"parameters":{"operation":"delete","key":"{{ $json.Chat_ID }}"},"id":"50869ff0-59db-423b-95ed-d3ed01b31cdb","name":"Redis","type":"n8n-nodes-base.redis","typeVersion":1,"position":[2460,620]},{"parameters":{"sessionIdType":"customKey","sessionKey":"={{ $('Telegram Trigger').item.json.message.chat.id }}"},"id":"292138d7-1ad4-4d50-90bc-e08951566530","name":"Window Buffer Memory","type":"@n8n/n8n-nodes-langchain.memoryBufferWindow","typeVersion":1.3,"position":[1960,820]},{"parameters":{"promptType":"define","text":"={{ $json.Mensaje }}","options":{"systemMessage":"Eres una amigable agente llamado Elle."}},"id":"8bc48dbb-4ea7-49e4-b526-512a33090bb8","name":"AI Agent","type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.7,"position":[1840,620]},{"parameters":{"updates":["messages"]},"id":"e2c9b2f6-36af-4539-b267-c97a2c129127","name":"WhatsApp Trigger","type":"n8n-nodes-base.whatsAppTrigger","typeVersion":1,"position":[-240,100],"webhookId":"b4d496c9-b44c-4359-8969-c93f84969504"},{"parameters":{"assignments":{"assignments":[{"id":"2a5e16fe-6d70-4519-97e5-74fcba455b33","name":"numero_telefono","value":"={{ $json.metadata.display_phone_number }}","type":"string"},{"id":"bc3eb5d3-dd56-4499-a769-85c3aae440de","name":"nombre_usuario","value":"={{ $json.contacts[0].profile.name }}","type":"string"},{"id":"3ef4bcbf-2798-4169-bf72-0a1a6714e728","name":"mensaje","value":"={{ $json.messages[0].text.body }}","type":"string"}]},"options":{}},"id":"824a7c14-be37-4e74-9e5a-2ec5c24a93c7","name":"Edit Fields","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-20,100]},{"parameters":{"operation":"send","additionalFields":{},"requestOptions":{}},"id":"e3f2f4af-c9f3-44ea-862f-6a5b9464e4d6","name":"WhatsApp Business Cloud","type":"n8n-nodes-base.whatsApp","typeVersion":1,"position":[560,400]}],"connections":{"Texto":{"main":[[{"node":"Envio_Datos","type":"main","index":0}]]},"Descarga_audio":{"main":[[{"node":"Transcribe audio a texto","type":"main","index":0}]]},"Transcribe audio a texto":{"main":[[{"node":"Audio","type":"main","index":0}]]},"Audio":{"main":[[{"node":"Envio_Datos","type":"main","index":0}]]},"Envio_Datos":{"main":[[{"node":"Guardar_Mensaje","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"Calculator":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"Switch":{"main":[[{"node":"Texto","type":"main","index":0}],[{"node":"Descarga_audio","type":"main","index":0}]]},"Guardar_Mensaje":{"main":[[{"node":"Wait","type":"main","index":0}]]},"Wait":{"main":[[{"node":"Recuperar_Mensaje","type":"main","index":0}]]},"Recuperar_Mensaje":{"main":[[{"node":"If","type":"main","index":0}]]},"If":{"main":[[{"node":"Juntar_Mensajes","type":"main","index":0}],[{"node":"No_hacer_nada","type":"main","index":0}]]},"Window Buffer Memory":{"ai_memory":[[{"node":"AI Agent","type":"ai_memory","index":0}]]},"Juntar_Mensajes":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"WhatsApp Trigger":{"main":[[{"node":"Edit Fields","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":null,"pinData":{},"versionId":"2b8b30af-9535-4fc4-b469-289c8d48f33e","triggerCount":0,"tags":[]}